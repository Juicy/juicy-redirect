<script>
    (function (global) {
        var PuppetRedirectElementPrototype = Object.create(HTMLLinkElement.prototype);


        /**
         * @event puppet-redirect-pushstate
         * Called whenever `history.state` is changed.
         * @property {String} url new URL
         */
        PuppetRedirectElementPrototype.attributeChangedCallback = function (attributeName, oldVal, newVal) {
            switch(attributeName) {
                case "url":
                    var url;
                    if(newVal == "current") {
                        url = window.location.href;
                    }
                    else {
                        url = newVal;
                    }
                    if(url != "") {
                        if(this.hasAttribute("history")) {
                            history.pushState(null, null, url);
                            this.dispatchEvent(
                                new CustomEvent(
                                    "puppet-redirect-pushstate",
                                    {
                                        "detail":{"url":url},
                                        "bubbles": true
                                    }
                                )
                            );
                        }
                        else {
                            window.location = url;
                        }
                        this.setAttribute("url", "");
                    }
                    break;
            }
        };

        global.PuppetRedirectElement = document.registerElement('puppet-redirect', {
            prototype: PuppetRedirectElementPrototype,
            extends: "link"
        });
    })(window);
</script>